---
title: "进程管理"  
date: 2025-10-20 23:01:20
categories: 
  - 八股
  - 操作系统  
---

# 进程管理

## 进程、线程、协程的区别

**本质区别**：进程是操作系统**资源分配**的基本单位，线程是是**任务调度和执行**的基本单位，协程是**用户态轻量级的执行单元**

* 进程：进程是操作系统**资源分配和调度的基本单位**，有独立的内存空间和系统资源。每个进程有自己独立的堆栈，进程间通信需要通过管道、消息队列、信号量等机制。由于进程有独立的内存空间，因此有较高的稳定性与安全性，上下文切换要保存和恢复整个进程状态，因此开销大。
* 线程：线程是**CPU调度和执行的基本单位**。线程共享进程的内存空间，包括堆和全局变量(每个线程有自己的栈)。线程上下文切换因为只需要保存自己的上下文而不是整个进程的，因此开销较小。由于多个线程共享内存空间，因此存在数据竞争和线程安全问题，需要通过同步和互斥机制来解决。
* 协程：协程是**用户态的轻量级执行单元**，由程序自身调度，而非操作系统内核。它基于线程实现，多个协程共享所属线程的资源，但每个协程有自己的栈和程序计数器。协程上下文切换完全由**用户代码控制**，无需内核参与，开销极小。协程适合处理大量 IO 密集型任务，通过 “协作式调度” 避免线程阻塞，在单线程中实现高并发；但在 CPU 密集型任务中优势不明显，且需要开发者手动处理协程间的同步问题。

## 为什么进程崩溃不会对其他进程产生很大影响

* 进程的隔离性：每个进程有自己独立的内存空间，进程崩溃，内存被操作系统回收，不影响其他进程的内存空间。进程崩溃不会影响其他进程执行。
* 进程的独立性：每个进程独立运行，不会共享资源。进程崩溃不会对其他资源产生影响。

线程崩溃会破坏进程的共享内存空间和资源状态，操作系统为了避免错误扩散，会回收进程资源，这会将整个进程和所有线程一起回收

## 进程分配的资源是什么

虚拟内存、文件句柄、信号量等

## 有了进程，为什么还需要线程

* 降低切换开销：线程共享进程资源，创建、销毁和切换速度远快于进程，大幅减少系统消耗。
* 便于数据共享：同一进程内线程可直接访问共享内存，无需复杂的进程间通信，数据交互更高效。
* 利于并发：线程是 CPU 调度的最小单位，多线程能充分利用多核 CPU，且单进程内可创建大量线程，实现更细粒度的并发控制。

## 多线程的优势与劣势

* 优势：发挥利用多核处理器的资源，同时处理多个任务，提高程序运行效率
* 劣势：存在多线程数据访问竞争问题，需要通过锁机制保证线程安全，增加了锁的开销，还会有死锁风险。多线程消耗更多的资源，如内存和CPU，每个线程都需要占用一定的内存和处理时间。

## 为什么多线程不是越多越好

* 切换开销：线程的创建与切换需要消耗系统资源，包括内存与CPU。如果创建太多线程会占用大量系统资源，导致系统负载过高，进而导致线程崩溃
* 死锁风险：过多的线程可能会导致竞争条件和死锁

## 进程切换和线程切换的区别

进程切换：包括整个进程的地址空间，全局变量，文件描述符，内存映射表等，开销大
线程切换：涉及线程的堆栈，寄存器，程序计数器等，开销小

## 线程切换的详细过程

1. 上下文保存：上下文信息包括寄存器状态，程序计数器，堆栈指针等，用于保存线程的执行状态
2. 切换到调度器：将执行权切换到调度器。调度器负责选择下一个要执行的进程，并根据调度算法进行决策
3. 上下文恢复：调度器选择下一个要执行的线程后，会从改线程保存的线程上下文恢复线程的执行状态
4. 切换线程：调度器将执行权切换到新线程，使其开始执行

上下文信息一般由操作系统负责保存，一般情况下保存在线程控制块（TCB）中

>TCB:操作系统用于管理线程的数据结构，包含线程状态，寄存器的值，堆栈信息等。当发生线程切换时，操作系统会切换TCB来保存和恢复线程的上下文

## 进程状态的切换过程

![进程管理-2025-10-22-00-31-26](https://csbase-blog.oss-cn-beijing.aliyuncs.com/进程管理-2025-10-22-00-31-26.png)

* null->新建状态 一个新进程被创建时的状态
* 新建状态->就绪状态：线程新建完成并完成初始化
* 就绪状态->运行状态：就绪状态被操作系统调度器选中后分配给CPU运行进程
* 运行状态->终止状态：进行运行完成或出错
* 运行状态->就绪状态：分配的时间片用完变为就绪态，操作系统选择其他就绪态进程进入运行态
* 运行状态->阻塞状态：当进程请求某个事件且必须等待时(如I/O请求)
* 阻塞状态->就绪状态：当进程要等待的时间完成时

## 进程的上下文有哪些

>CPU上下文：寄存器，程序计数器等CPU运行前必须依赖的环境
CPU上下文切换：把前一个任务的CPU保存起来(系统内核保存)，然后加载新任务的CPU上下文，跳转到程序计数器的新位置执行任务

进程是由内核进行调度和管理的，进程调度发生在**内核态**

进程的上下文切换包括虚拟内存、栈、全局变量等用户空间资源，还包括内核堆栈、寄存器等内核空间的资源

通常把交换信息保存在进程的PCB中，当运行另一个进程时，从进程的PCB中取出上下文，然后恢复到CPU,使进程可以继续执行
